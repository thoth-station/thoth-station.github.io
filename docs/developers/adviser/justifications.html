
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>Justifications by the recommendation engine &#8212; Thoth Adviser 0.49.0 documentation</title>
    <link rel="stylesheet" href="/assets/adviser/nameko.css" type="text/css" />
    <link rel="stylesheet" href="/assets/adviser/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="/assets/adviser/documentation_options.js"></script>
    <script type="text/javascript" src="/assets/adviser/jquery.js"></script>
    <script type="text/javascript" src="/assets/adviser/underscore.js"></script>
    <script type="text/javascript" src="/assets/adviser/doctools.js"></script>
    <script type="text/javascript" src="/assets/adviser/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Thoth Security Advises" href="security.html" />
    <link rel="prev" title="Predictor in Thoth’s adviser" href="predictor.html" />

   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-123174547-2']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="security.html" title="Thoth Security Advises"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="predictor.html" title="Predictor in Thoth’s adviser"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Thoth Adviser 0.49.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="justifications-by-the-recommendation-engine">
<span id="justifications"></span><h1>Justifications by the recommendation engine<a class="headerlink" href="#justifications-by-the-recommendation-engine" title="Permalink to this headline">¶</a></h1>
<p>When the recommendation engine produces advises, it also provides comments on
why the given recommendation was produced. These snippets are called
“justifications” and are a textual form to justify actions taken by the
recommendation engine.</p>
<p>Some of the justifications that can be produced by the recommendation
engine are available at <a class="reference external" href="https://thoth-station.ninja/justifications">thoth-station.ninja/justifications</a>. These are documents linked
from the <span class="xref std std-ref">pipeline units</span> present in the <a class="reference internal" href="pipeline.html#pipeline"><span class="std std-ref">pipeline
configuration</span></a> during the software stack resolution. Some of the
justifications can be produced directly by the <a class="reference internal" href="resolver.html#resolver"><span class="std std-ref">resolver</span></a> or
<a class="reference internal" href="predictor.html#predictor"><span class="std std-ref">predictor</span></a>.</p>
<section id="creating-justification-documents">
<h2>Creating justification documents<a class="headerlink" href="#creating-justification-documents" title="Permalink to this headline">¶</a></h2>
<p>If you wish to create a justification, follow already existing template
available in <a class="reference external" href="https://github.com/thoth-station/thoth-station.github.io/blob/master/_j/_example.md">thoth-station.github.io repo</a>
and fill in missing parts.</p>
<p>Name the file name in a SEO friendly way and keep it short so that the URL
generated is as short as possible.</p>
</section>
<section id="linking-justification-documents-from-adviser">
<span id="jl"></span><h2>Linking justification documents from adviser<a class="headerlink" href="#linking-justification-documents-from-adviser" title="Permalink to this headline">¶</a></h2>
<p>To create a justification, you can use <code class="docutils literal notranslate"><span class="pre">get_justification_link</span></code> from
<code class="docutils literal notranslate"><span class="pre">thoth-common</span></code> module. A common idiom is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">thoth.common</span> <span class="kn">import</span> <span class="n">get_justification_link</span> <span class="k">as</span> <span class="n">jl</span>

<span class="n">link</span> <span class="o">=</span> <span class="n">jl</span><span class="p">(</span><span class="s2">&quot;my_justification&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">my_justification</span></code> part directly corresponds to the name of the Markdown
file with justification as placed in the <code class="docutils literal notranslate"><span class="pre">_j/</span></code> directory (without
the <code class="docutils literal notranslate"><span class="pre">.md</span></code> suffix). The linked justification will be named
<code class="docutils literal notranslate"><span class="pre">my_justification.md</span></code> and will be placed in <a class="reference external" href="https://github.com/thoth-station/thoth-station.github.io/tree/master/_j">thoth-station.github.io/_j</a>.
The justification document is automatically built on push to master and the
justification is automatically available in the justification listing.</p>
</section>
<section id="adding-justifications-to-the-recommended-software">
<span id="justification"></span><h2>Adding justifications to the recommended software<a class="headerlink" href="#adding-justifications-to-the-recommended-software" title="Permalink to this headline">¶</a></h2>
<p>There are two possibilities how to provide justifications to the users. In both
cases, justifications should follow pre-defined schema already defined in
Thoth’s adviser test-suite (see <code class="docutils literal notranslate"><span class="pre">AdviserTestCase._JUSTIFICATION_SCHEMA</span></code> in
<code class="docutils literal notranslate"><span class="pre">tests/base.py</span></code>).</p>
<section id="justifications-for-recommended-software-stack">
<span id="stack-info"></span><h3>Justifications for recommended software stack<a class="headerlink" href="#justifications-for-recommended-software-stack" title="Permalink to this headline">¶</a></h3>
<p>The very first use of justification schema uses <a class="reference internal" href="steps.html#steps"><span class="std std-ref">step pipeline units</span></a>. These units can return justification as part of their results and are
specific to the software stack resolved.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">from</span> <span class="nn">thoth.common</span> <span class="kn">import</span> <span class="n">get_justification_link</span> <span class="k">as</span> <span class="n">jl</span>
<span class="kn">from</span> <span class="nn">thoth.python</span> <span class="kn">import</span> <span class="n">PackageVersion</span>
<span class="kn">from</span> <span class="nn">thoth.storages.exceptions</span> <span class="kn">import</span> <span class="n">NotFoundError</span>
<span class="kn">from</span> <span class="nn">voluptuous</span> <span class="kn">import</span> <span class="n">Required</span>
<span class="kn">from</span> <span class="nn">voluptuous</span> <span class="kn">import</span> <span class="n">Schema</span>

<span class="kn">from</span> <span class="nn">thoth.adviser.step</span> <span class="kn">import</span> <span class="n">Step</span>
<span class="kn">from</span> <span class="nn">thoth.adviser.state</span> <span class="kn">import</span> <span class="n">State</span>

<span class="n">_LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CvePenalizationStep</span><span class="p">(</span><span class="n">Step</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Penalization based on CVE being present in stack.&quot;&quot;&quot;</span>

    <span class="n">CONFIGURATION_DEFAULT</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;package_name&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;cve_penalization&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">}</span>
    <span class="n">CONFIGURATION_SCHEMA</span><span class="p">:</span> <span class="n">Schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">({</span><span class="n">Required</span><span class="p">(</span><span class="s2">&quot;package_name&quot;</span><span class="p">):</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Required</span><span class="p">(</span><span class="s2">&quot;cve_penalization&quot;</span><span class="p">):</span> <span class="nb">float</span><span class="p">})</span>
    <span class="n">_JUSTIFICATION_LINK</span> <span class="o">=</span> <span class="n">jl</span><span class="p">(</span><span class="s2">&quot;cve&quot;</span><span class="p">)</span>

    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">package_version</span><span class="p">:</span> <span class="n">PackageVersion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]:</span>
        <span class="sd">&quot;&quot;&quot;Penalize stacks with a CVE.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cve_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_python_cve_records_all</span><span class="p">(</span>
                <span class="n">package_name</span><span class="o">=</span><span class="n">package_version</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">package_version</span><span class="o">=</span><span class="n">package_version</span><span class="o">.</span><span class="n">locked_version</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Package </span><span class="si">%r</span><span class="s2"> in version </span><span class="si">%r</span><span class="s2"> not found: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">cve_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="p">[</span><span class="s2">&quot;cve_penalization&quot;</span><span class="p">],</span> <span class="p">[{</span>
                <span class="s2">&quot;package_name&quot;</span><span class="p">:</span> <span class="n">package_version</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JUSTIFICATION_LINK</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Found at least one vulnerability for the given package:&quot;</span>
            <span class="p">}]</span>

        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
<p>The value returned corresponds to a list of justifications that should be
reported when a software stack is resolved from the <code class="docutils literal notranslate"><span class="pre">state</span></code> taking the step
described in the pipeline unit (an action taken from a state to another state
as seen in <a class="reference internal" href="introduction.html#introduction"><span class="std std-ref">Markov Decision Process</span></a>). Follow <a class="reference internal" href="steps.html#steps"><span class="std std-ref">steps
documentation</span></a> for more info.</p>
</section>
<section id="justifications-on-stack-level">
<h3>Justifications on stack level<a class="headerlink" href="#justifications-on-stack-level" title="Permalink to this headline">¶</a></h3>
<p>There is also a possibility to provide justifications on the stack level. These
justifications will always show up to the user with the recommended software
stack and are on the “stack level”. An example of such justifications can be an
informative message about the direct dependencies used, software environment
used or hardware environment used - all these are not thought to the
recommended set of Python packages.</p>
<p>To do so, any pipeline unit can add justifications to the context before,
during or after the resolution process is done:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">attr</span>

<span class="kn">from</span> <span class="nn">thoth.adviser.boot</span> <span class="kn">import</span> <span class="n">Boot</span>
<span class="kn">from</span> <span class="nn">thoth.common</span> <span class="kn">import</span> <span class="n">get_justification_link</span> <span class="k">as</span> <span class="n">jl</span>

<span class="n">_LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UbiBoot</span><span class="p">(</span><span class="n">Boot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remap UBI to RHEL.</span>

<span class="sd">    As UBI has ABI compatibility with RHEL, remap any UBI to RHEL.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_MESSAGE</span> <span class="o">=</span> <span class="s2">&quot;Using observations for RHEL instead of UBI, RHEL is ABI compatible with UBI&quot;</span>
    <span class="n">_JUSTIFICATION_LINK</span> <span class="o">=</span> <span class="n">jl</span><span class="p">(</span><span class="s2">&quot;rhel_ubi&quot;</span><span class="p">)</span>

    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Remap UBI to RHEL as Thoth keeps track of RHEL and UBI is ABI compatible.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">runtime_environment</span><span class="o">.</span><span class="n">operating_system</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ubi&quot;</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - see </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MESSAGE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JUSTIFICATION_LINK</span><span class="p">)</span>

            <span class="c1"># &gt;&gt;&gt; Add justification to the stack info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">stack_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MESSAGE</span><span class="p">,</span> <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JUSTIFICATION_LINK</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="c1"># &lt;&lt;&lt; Add justification to the stack info</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">runtime_environment</span><span class="o">.</span><span class="n">operating_system</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;rhel&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Justifications by the recommendation engine</a><ul>
<li><a class="reference internal" href="#creating-justification-documents">Creating justification documents</a></li>
<li><a class="reference internal" href="#linking-justification-documents-from-adviser">Linking justification documents from adviser</a></li>
<li><a class="reference internal" href="#adding-justifications-to-the-recommended-software">Adding justifications to the recommended software</a><ul>
<li><a class="reference internal" href="#justifications-for-recommended-software-stack">Justifications for recommended software stack</a></li>
<li><a class="reference internal" href="#justifications-on-stack-level">Justifications on stack level</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation index</a><ul>
      <li>Previous: <a href="predictor.html" title="previous chapter">Predictor in Thoth’s adviser</a></li>
      <li>Next: <a href="security.html" title="next chapter">Thoth Security Advises</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="sources/justifications.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

  
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>

  </body>
</html>