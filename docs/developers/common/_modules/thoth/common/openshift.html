
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>thoth.common.openshift &#8212; Thoth Common 0.18.3 documentation</title>
    <link rel="stylesheet" href="../../..//assets/nameko.css" type="text/css" />
    <link rel="stylesheet" href="../../..//assets/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../..//assets/documentation_options.js"></script>
    <script type="text/javascript" src="../../..//assets/jquery.js"></script>
    <script type="text/javascript" src="../../..//assets/underscore.js"></script>
    <script type="text/javascript" src="../../..//assets/doctools.js"></script>
    <script type="text/javascript" src="../../..//assets/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-123174547-2']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Thoth Common 0.18.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for thoth.common.openshift</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># thoth-common</span>
<span class="c1"># Copyright(C) 2018, 2019, 2020 Fridolin Pokorny</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and / or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;Handling OpenShift and Kubernetes objects across project.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">urllib3</span>

<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">openshift.dynamic.exceptions</span> <span class="kn">import</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">OpenShiftNotFoundError</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">ThothCommonException</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">NotKnownThothIntegration</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">QebHwtInputsMissing</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">KebechetInputsMissing</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">NotFoundException</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">ConfigurationError</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">SolverNameParseError</span>
<span class="kn">from</span> <span class="nn">.helpers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_service_account_token</span><span class="p">,</span>
    <span class="n">_get_incluster_token_file</span><span class="p">,</span>
    <span class="n">_get_incluster_ca_file</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.enums</span> <span class="kn">import</span> <span class="n">ThothAdviserIntegrationEnum</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.workflows</span> <span class="kn">import</span> <span class="n">WorkflowManager</span>

<span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">()</span>
<span class="n">_LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="OpenShift"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift">[docs]</a><span class="k">class</span> <span class="nc">OpenShift</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Interaction with OpenShift Master.&quot;&quot;&quot;</span>

    <span class="n">_DEFAULT_WORKLOAD_LABELS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;app&quot;</span><span class="p">:</span> <span class="s2">&quot;thoth&quot;</span><span class="p">,</span> <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;workload&quot;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">frontend_namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">middletier_namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">backend_namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">infra_namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">amun_infra_namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">amun_inspection_namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kubernetes_api_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kubernetes_verify_tls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">openshift_api_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">token_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cert_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">environ</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize OpenShift class responsible for handling objects in deployment.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">kubernetes</span> <span class="kn">import</span> <span class="n">client</span><span class="p">,</span> <span class="n">config</span>
            <span class="kn">from</span> <span class="nn">openshift.dynamic</span> <span class="kn">import</span> <span class="n">DynamicClient</span>
            <span class="kn">from</span> <span class="nn">kubernetes.config.incluster_config</span> <span class="kn">import</span> <span class="n">InClusterConfigLoader</span>
            <span class="kn">from</span> <span class="nn">kubernetes.client.rest</span> <span class="kn">import</span> <span class="n">RESTClientObject</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to import OpenShift and Kubernetes packages. Was thoth-common library &quot;</span>
                <span class="s2">&quot;installed with openshift extras?&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_verify_tls</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KUBERNETES_VERIFY_TLS&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="ow">and</span> <span class="n">kubernetes_verify_tls</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">in_cluster</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Try to load configuration as used in cluster. If not possible, try to load it from local configuration.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Load in-cluster configuration that is exposed by OpenShift/k8s configuration.</span>
            <span class="n">InClusterConfigLoader</span><span class="p">(</span>
                <span class="n">token_filename</span><span class="o">=</span><span class="n">_get_incluster_token_file</span><span class="p">(</span><span class="n">token_file</span><span class="p">),</span>
                <span class="n">cert_filename</span><span class="o">=</span><span class="n">_get_incluster_ca_file</span><span class="p">(</span><span class="n">cert_file</span><span class="p">),</span>
                <span class="n">environ</span><span class="o">=</span><span class="n">environ</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">load_and_set</span><span class="p">()</span>

            <span class="c1"># We need to explicitly set whether we want to verify SSL/TLS connection to the master.</span>
            <span class="n">configuration</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">Configuration</span><span class="p">()</span>
            <span class="n">configuration</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_verify_tls</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span> <span class="o">=</span> <span class="n">DynamicClient</span><span class="p">(</span>
                <span class="n">client</span><span class="o">.</span><span class="n">ApiClient</span><span class="p">(</span><span class="n">configuration</span><span class="o">=</span><span class="n">configuration</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Failed to load in cluster configuration, fallback to a local development setup: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">k8s_client</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">new_client_from_config</span><span class="p">()</span>
            <span class="n">k8s_client</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_verify_tls</span>
            <span class="n">k8s_client</span><span class="o">.</span><span class="n">rest_client</span> <span class="o">=</span> <span class="n">RESTClientObject</span><span class="p">(</span><span class="n">k8s_client</span><span class="o">.</span><span class="n">configuration</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span> <span class="o">=</span> <span class="n">DynamicClient</span><span class="p">(</span><span class="n">k8s_client</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_cluster</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">configuration</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">amun_inspection_namespace</span> <span class="o">=</span> <span class="n">amun_inspection_namespace</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;THOTH_AMUN_INSPECTION_NAMESPACE&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amun_infra_namespace</span> <span class="o">=</span> <span class="n">amun_infra_namespace</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;THOTH_AMUN_INFRA_NAMESPACE&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frontend_namespace</span> <span class="o">=</span> <span class="n">frontend_namespace</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;THOTH_FRONTEND_NAMESPACE&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">middletier_namespace</span> <span class="o">=</span> <span class="n">middletier_namespace</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;THOTH_MIDDLETIER_NAMESPACE&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend_namespace</span> <span class="o">=</span> <span class="n">backend_namespace</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;THOTH_BACKEND_NAMESPACE&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infra_namespace</span> <span class="o">=</span> <span class="n">infra_namespace</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;THOTH_INFRA_NAMESPACE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_api_url</span> <span class="o">=</span> <span class="n">kubernetes_api_url</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;KUBERNETES_API_URL&quot;</span><span class="p">,</span> <span class="s2">&quot;https://kubernetes.default.svc.cluster.local&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openshift_api_url</span> <span class="o">=</span> <span class="n">openshift_api_url</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;OPENSHIFT_API_URL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">host</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">token</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_verify_tls</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;TLS verification when communicating with k8s/okd master is disabled&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_manager</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;WorkflowManager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Access service account token mounted to the pod.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_cluster</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">get_service_account_token</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Ugly, but k8s client does not expose a nice API for this.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">auth_settings</span><span class="p">()[</span>
                    <span class="s2">&quot;BearerToken&quot;</span>
                <span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workflow_manager</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;WorkflowManager&quot;</span><span class="p">:</span>  <span class="c1"># by using a string here we create a forward reference</span>
        <span class="sd">&quot;&quot;&quot;Return WorkflowManager instance.</span>

<span class="sd">        This property lazily initializes the WorkflowManager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.workflows</span> <span class="kn">import</span> <span class="n">WorkflowManager</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_manager</span> <span class="o">=</span> <span class="n">WorkflowManager</span><span class="p">(</span><span class="n">openshift</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workflow_manager</span>

<div class="viewcode-block" id="OpenShift.normalize_os_version"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.normalize_os_version">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">normalize_os_version</span><span class="p">(</span>
        <span class="n">os_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">os_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Normalize operating system version based on operating system used.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">os_version</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">os_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;rhel&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os_version</span>

        <span class="c1"># Discard any minor release, if present.</span>
        <span class="k">return</span> <span class="n">os_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="OpenShift.parse_python_solver_name"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.parse_python_solver_name">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_python_solver_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">solver_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Parse os and Python identifiers encoded into solver name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">solver_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;solver-&quot;</span><span class="p">):</span>
            <span class="n">solver_identifiers</span> <span class="o">=</span> <span class="n">solver_name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;solver-&quot;</span><span class="p">)</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SolverNameParseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Solver name has to start with &#39;solver-&#39; prefix: </span><span class="si">{</span><span class="n">solver_name</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="n">solver_identifiers</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SolverNameParseError</span><span class="p">(</span>
                <span class="s2">&quot;Solver should be in a form of &#39;solver-&lt;os_name&gt;-&lt;os_version&gt;-&lt;python_version&gt;, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;solver name </span><span class="si">{</span><span class="n">solver_name</span><span class="si">!r}</span><span class="s2"> does not correspond to this naming schema&quot;</span>
            <span class="p">)</span>

        <span class="n">python_version</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">python_version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;py&quot;</span><span class="p">):</span>
            <span class="n">python_version</span> <span class="o">=</span> <span class="n">python_version</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;py&quot;</span><span class="p">)</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SolverNameParseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Python version encoded into Python solver name does not start with &#39;py&#39; prefix: </span><span class="si">{</span><span class="n">solver_name</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">python_version</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">python_version</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;os_name&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;os_version&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">normalize_os_version</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s2">&quot;python_version&quot;</span><span class="p">:</span> <span class="n">python_version</span><span class="p">,</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="OpenShift.obtain_solver_from_runtime_environment"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.obtain_solver_from_runtime_environment">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">obtain_solver_from_runtime_environment</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">runtime_environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Define solver from runtime_environment.&quot;&quot;&quot;</span>
        <span class="n">solver</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">operating_system</span> <span class="o">=</span> <span class="n">runtime_environment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;operating_system&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">operating_system</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">solver</span>

        <span class="n">os_name</span> <span class="o">=</span> <span class="n">runtime_environment</span><span class="p">[</span><span class="s2">&quot;operating_system&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">os_version</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">normalize_os_version</span><span class="p">(</span>
            <span class="n">operating_system</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span> <span class="n">operating_system</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">python_version</span> <span class="o">=</span> <span class="n">runtime_environment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;python_version&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os_version</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">solver</span>

        <span class="k">if</span> <span class="n">python_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">solver</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;solver-</span><span class="si">{</span><span class="n">os_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">os_version</span><span class="si">}</span><span class="s2">-py</span><span class="si">{</span><span class="n">python_version</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solver</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;solver-</span><span class="si">{</span><span class="n">os_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">os_version</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">parse_python_solver_name</span><span class="p">(</span><span class="n">solver</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">solver</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_set_env_var</span><span class="p">(</span><span class="n">template</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">**</span><span class="n">env_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set environment in the given template.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">env_var_name</span><span class="p">,</span> <span class="n">env_var_value</span> <span class="ow">in</span> <span class="n">env_var</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">][</span><span class="s2">&quot;containers&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;env&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">env_var_name</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_var_value</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">template</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">][</span><span class="s2">&quot;containers&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;env&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">env_var_name</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">env_var_value</span><span class="p">)}</span>
                <span class="p">)</span>

<div class="viewcode-block" id="OpenShift.set_template_parameters"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.set_template_parameters">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_template_parameters</span><span class="p">(</span><span class="n">template</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">**</span><span class="n">parameters</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set parameters in the template - replace existing ones or append to parameter list if not exist.</span>

<span class="sd">        &gt;&gt;&gt; set_template_parameters(template, THOTH_LOG_ADVISER=&#39;DEBUG&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Setting parameters for template </span><span class="si">%r</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">template</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;parameters&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">template</span><span class="p">:</span>
            <span class="n">template</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">parameter_name</span><span class="p">,</span> <span class="n">parameter_value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">parameter_name</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">)</span> <span class="k">if</span> <span class="n">parameter_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Requested to assign parameter </span><span class="si">%r</span><span class="s2"> (value </span><span class="si">%r</span><span class="s2">) to template but template &quot;</span>
                    <span class="s2">&quot;does not provide the given parameter, forcing...&quot;</span><span class="p">,</span>
                    <span class="n">parameter_name</span><span class="p">,</span>
                    <span class="n">parameter_value</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">template</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">parameter_name</span><span class="p">,</span>
                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">parameter_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.get_pod_log"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_pod_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_pod_log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pod_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">container</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get log of a pod based on assigned pod ID.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">namespace</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                    <span class="s2">&quot;Middletier namespace is required to check log of pods run in this namespace&quot;</span>
                <span class="p">)</span>
            <span class="n">namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">middletier_namespace</span>

        <span class="n">params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">container</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;container&quot;</span><span class="p">:</span> <span class="n">container</span><span class="p">}</span>

        <span class="c1"># TODO: rewrite to OpenShift rest client once it will support it.</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api/v1/namespaces/</span><span class="si">{}</span><span class="s2">/pods/</span><span class="si">{}</span><span class="s2">/log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift_api_url</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">pod_id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">),</span>
                <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_verify_tls</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Kubernetes master response for pod log (</span><span class="si">%d</span><span class="s2">): </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Pod with id </span><span class="si">{</span><span class="n">pod_id</span><span class="si">}</span><span class="s2"> was not found in namespace </span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">400</span>
            <span class="ow">and</span> <span class="s2">&quot;a container name must be specified for pod&quot;</span>
            <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="c1"># If Pod has not been initialized yet, there is returned 400 status code. Return None in this case.</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ThothCommonException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to obtain logs, container name has to be specified: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span></div>

<div class="viewcode-block" id="OpenShift.get_workflow_node_log"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_workflow_node_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflow_node_log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get log from a task/node in a workflow.&quot;&quot;&quot;</span>
        <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflow</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">for</span> <span class="n">pod_name</span><span class="p">,</span> <span class="n">node_info</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node_info</span><span class="p">[</span><span class="s2">&quot;displayName&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pod_log</span><span class="p">(</span><span class="n">pod_name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No node </span><span class="si">{</span><span class="n">node_name</span><span class="si">!r}</span><span class="s2"> in workflow </span><span class="si">{</span><span class="n">workflow_id</span><span class="si">!r}</span><span class="s2"> in namespace </span><span class="si">{</span><span class="n">namespace</span><span class="si">!r}</span><span class="s2"> found&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.get_build"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_build">[docs]</a>    <span class="k">def</span> <span class="nf">get_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get a build in the given namespace.&quot;&quot;&quot;</span>
        <span class="c1"># TODO: rewrite to OpenShift rest client once it will support it.</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/apis/build.openshift.io/v1/namespaces/</span><span class="si">{}</span><span class="s2">/builds/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift_api_url</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">build_id</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">),</span>
                <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_verify_tls</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Build with id </span><span class="si">{</span><span class="n">build_id</span><span class="si">}</span><span class="s2"> was not found in namespace </span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;OpenShift master response for build (</span><span class="si">%d</span><span class="s2">): </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="OpenShift.get_buildconfig"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_buildconfig">[docs]</a>    <span class="k">def</span> <span class="nf">get_buildconfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buildconfig_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get a buildconfig in the given namespace.&quot;&quot;&quot;</span>
        <span class="c1"># TODO: rewrite to OpenShift rest client once it will support it.</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/apis/build.openshift.io/v1/namespaces/</span><span class="si">{}</span><span class="s2">/buildconfigs/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift_api_url</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">buildconfig_id</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">),</span>
                <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_verify_tls</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;BuildConfig with id </span><span class="si">{</span><span class="n">buildconfig_id</span><span class="si">}</span><span class="s2"> was not found in namespace </span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;OpenShift master response for build (</span><span class="si">%d</span><span class="s2">): </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="OpenShift.get_build_log"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_build_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_build_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get log of a build in the given namespace.&quot;&quot;&quot;</span>
        <span class="c1"># TODO: rewrite to OpenShift rest client once it will support it.</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/apis/build.openshift.io/v1/namespaces/</span><span class="si">{}</span><span class="s2">/builds/</span><span class="si">{}</span><span class="s2">/log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift_api_url</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">build_id</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">),</span>
                <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_verify_tls</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Build with id </span><span class="si">{</span><span class="n">build_id</span><span class="si">}</span><span class="s2"> was not found in namespace </span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;OpenShift master response for build log (</span><span class="si">%d</span><span class="s2">): </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span></div>

<div class="viewcode-block" id="OpenShift.get_pod_status"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_pod_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_pod_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pod_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get status entry for a pod - low level routine.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">openshift</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;Pod&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pod_id</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">openshift</span><span class="o">.</span><span class="n">dynamic</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The given pod with id </span><span class="si">{</span><span class="n">pod_id</span><span class="si">}</span><span class="s2"> could not be found&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;OpenShift master response for pod status: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;containerStatuses&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
            <span class="c1"># No status - pod is being scheduled.</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="s2">&quot;containerStatuses&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;state&quot;</span><span class="p">]</span>
        <span class="c1"># Translate kills of liveness probes to our messages reported to user.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;terminated&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exitCode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">137</span>
            <span class="ow">and</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;terminated&quot;</span><span class="p">][</span><span class="s2">&quot;reason&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Error&quot;</span>
        <span class="p">):</span>
            <span class="c1"># Reason can be set by OpenShift to be OOMKilled for example - we expect only &quot;Error&quot; to be set to</span>
            <span class="c1"># treat this as timeout.</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;terminated&quot;</span><span class="p">][</span><span class="s2">&quot;reason&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;TimeoutKilled&quot;</span>

        <span class="k">return</span> <span class="n">state</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_status_report</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Construct status response for API response from master API response.&quot;&quot;&quot;</span>
        <span class="n">_TRANSLATION_TABLE</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># noqa</span>
            <span class="s2">&quot;exitCode&quot;</span><span class="p">:</span> <span class="s2">&quot;exit_code&quot;</span><span class="p">,</span>
            <span class="s2">&quot;finishedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;finished_at&quot;</span><span class="p">,</span>
            <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;reason&quot;</span><span class="p">,</span>
            <span class="s2">&quot;startedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;started_at&quot;</span><span class="p">,</span>
            <span class="s2">&quot;containerID&quot;</span><span class="p">:</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;reason&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># If pod was not initialized yet and user asks for status, return default values with state scheduling.</span>
            <span class="n">reported_status</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">_TRANSLATION_TABLE</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="n">reported_status</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;scheduling&quot;</span>
            <span class="k">return</span> <span class="n">reported_status</span>

        <span class="n">state</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">reported_status</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">_TRANSLATION_TABLE</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">reported_status</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">status</span><span class="p">[</span><span class="n">state</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;containerID&quot;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">value</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;docker://&quot;</span><span class="p">)</span> <span class="p">:]</span>
                    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;docker://&quot;</span><span class="p">)</span>
                    <span class="k">else</span> <span class="n">value</span>
                <span class="p">)</span>
                <span class="n">reported_status</span><span class="p">[</span><span class="s2">&quot;container&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reported_status</span><span class="p">[</span><span class="n">_TRANSLATION_TABLE</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">reported_status</span>

<div class="viewcode-block" id="OpenShift.get_pod_status_report"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_pod_status_report">[docs]</a>    <span class="k">def</span> <span class="nf">get_pod_status_report</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">pod_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Get pod state and convert it to a user-friendly response.&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pod_status</span><span class="p">(</span><span class="n">pod_id</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status_report</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_pod_id_from_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get a single pod name from a job.&quot;&quot;&quot;</span>
        <span class="c1"># Kubernetes automatically adds &#39;job-name&#39; label -&gt; reuse it.</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;Pod&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;job-name=</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;OpenShift response for pod id from job: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Log this error and report back to user not found.</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Multiple pods for the same job name selector </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> found&quot;</span>
                <span class="p">)</span>

            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job with the given id </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> was not found&quot;</span><span class="p">)</span>

        <span class="n">result</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_get_pod_ids_from_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get multiple pod names from a job.</span>

<span class="sd">        This function is useful for a Job which schedules multiple pods, i.e.</span>
<span class="sd">        when run to completion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Kubernetes automatically adds &#39;job-name&#39; label -&gt; reuse it.</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;Pod&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;job-name=</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;OpenShift response for pod ids from job: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])):</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job with the given id </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> was not found&quot;</span><span class="p">)</span>

        <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pod</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pod</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="OpenShift.get_configmap"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_configmap">[docs]</a>    <span class="k">def</span> <span class="nf">get_configmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configmap_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the given configmap in a namespace, return object representing config map.&quot;&quot;&quot;</span>
        <span class="n">v1_configmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;ConfigMap&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1_configmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">configmap_id</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="n">OpenShiftNotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Configmap </span><span class="si">{</span><span class="n">configmap_id</span><span class="si">!r}</span><span class="s2"> not found in namespace </span><span class="si">{</span><span class="n">namespace</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span></div>

<div class="viewcode-block" id="OpenShift.get_configmaps"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_configmaps">[docs]</a>    <span class="k">def</span> <span class="nf">get_configmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get all configmaps in a namespace and select them by label.&quot;&quot;&quot;</span>
        <span class="n">v1_configmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;ConfigMap&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1_configmap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="OpenShift.get_image_streams"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_image_streams">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get all image streams in a namespace and select them by label.&quot;&quot;&quot;</span>
        <span class="n">v1_image_streams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;image.openshift.io/v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;ImageStream&quot;</span>
        <span class="p">)</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1_image_streams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="OpenShift.get_job_status"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_job_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get status of a Job and Pods created by the Job.</span>

<span class="sd">        :raises: NotFoundError if no Job of such name is found in the namespace</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_TRANSLATION_TABLE</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># noqa</span>
            <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="s2">&quot;started_at&quot;</span><span class="p">,</span>
            <span class="s2">&quot;completionTime&quot;</span><span class="p">:</span> <span class="s2">&quot;finished_at&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">job_status</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;batch/v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;Job&quot;</span>
            <span class="p">)</span>

            <span class="n">job</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">job_id</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">job</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;conditions&quot;</span><span class="p">:</span>
                    <span class="c1"># conditions are discarded</span>
                    <span class="k">continue</span>
                <span class="n">job_status</span><span class="p">[</span><span class="n">_TRANSLATION_TABLE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>

            <span class="c1"># add completions information so that we can determine whether</span>
            <span class="c1"># the Job is already finished according to the number of `succeeded`</span>
            <span class="c1"># pods</span>
            <span class="n">job_status</span><span class="p">[</span><span class="s2">&quot;completions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">][</span><span class="s2">&quot;completions&quot;</span><span class="p">]</span>

        <span class="k">except</span> <span class="n">OpenShiftNotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">!r}</span><span class="s2"> not found in namespace </span><span class="si">{</span><span class="n">namespace</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

        <span class="k">return</span> <span class="n">job_status</span></div>

<div class="viewcode-block" id="OpenShift.get_job_status_report"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_job_status_report">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_status_report</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Get status report of a Job and Pods created by the Job.&quot;&quot;&quot;</span>
        <span class="n">report</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

        <span class="n">pod_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pod_ids_from_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="n">pods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_pod_status_report</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pod_ids</span>
        <span class="p">]</span>

        <span class="n">report</span><span class="p">[</span><span class="s2">&quot;pods&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pods</span>
        <span class="k">return</span> <span class="n">report</span></div>

<div class="viewcode-block" id="OpenShift.get_job_log"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_job_log">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get log of a pod running inside a job.&quot;&quot;&quot;</span>
        <span class="n">pod_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pod_id_from_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pod_log</span><span class="p">(</span><span class="n">pod_id</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.get_job_logs"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_job_logs">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get log of a pod running inside a job.&quot;&quot;&quot;</span>
        <span class="n">pod_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pod_id_from_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pod_log</span><span class="p">(</span><span class="n">pod_id</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.get_jobs"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">get_jobs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">label_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get all Jobs, select them by the provided label.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">openshift</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;batch/v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;Job&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">openshift</span><span class="o">.</span><span class="n">dynamic</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No Jobs with label </span><span class="si">{</span><span class="n">label_selector</span><span class="si">}</span><span class="s2"> could be found&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;OpenShift response: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

    <span class="k">def</span> <span class="nf">_get_template</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">_label_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get template from infra namespace, use label_selector to identify which template to get.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;template.openshift.io/v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;Template&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;templates&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">_label_selector</span>
        <span class="p">)</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;OpenShift response for getting template by label_selector </span><span class="si">%r</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">_label_selector</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_on_invalid_response_size</span><span class="p">(</span>
            <span class="n">response</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">_label_selector</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span>
        <span class="p">)</span>
        <span class="n">template</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s2">&quot;items&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">template</span>

    <span class="k">def</span> <span class="nf">_get_cronjob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_label_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get template from infra namespace, use label_selector to identify which template to get.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;batch/v1beta1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;CronJob&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">_label_selector</span><span class="p">)</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;OpenShift response for getting CronJob by label_selector </span><span class="si">%r</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">_label_selector</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_on_invalid_response_size</span><span class="p">(</span>
            <span class="n">response</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">_label_selector</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span>
        <span class="p">)</span>
        <span class="n">template</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s2">&quot;items&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">template</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_transform_cronjob_to_job</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Turn a CronJob into a job so that it can be directly run.&quot;&quot;&quot;</span>
        <span class="n">job_spec</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">][</span><span class="s2">&quot;jobTemplate&quot;</span><span class="p">]</span>
        <span class="n">job_spec</span><span class="p">[</span><span class="s2">&quot;apiVersion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;batch/v1&quot;</span>
        <span class="n">job_spec</span><span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Job&quot;</span>
        <span class="n">job_spec</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;generateName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span>
        <span class="k">return</span> <span class="n">job_spec</span>

<div class="viewcode-block" id="OpenShift.schedule_graph_refresh"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_graph_refresh">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_graph_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Schedule graph refresh job in frontend namespace by default.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">frontend_namespace</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                    <span class="s2">&quot;No frontend namespace configured to run graph-refresh job&quot;</span>
                <span class="p">)</span>

            <span class="n">namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frontend_namespace</span>

        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cronjob</span><span class="p">(</span><span class="s2">&quot;component=graph-refresh&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_cronjob_to_job</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

        <span class="c1"># There are no template parameters as we are directly using a cronjob as a template, directly run the job.</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">api_version</span><span class="o">=</span><span class="n">template</span><span class="p">[</span><span class="s2">&quot;apiVersion&quot;</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="n">template</span><span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">template</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;OpenShift response for creating job: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="n">result</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="OpenShift.schedule_inspection"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_inspection">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_inspection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dockerfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">specification</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">raw_specification</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule an inspection run.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">amun_inspection_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to schedule inspection without Amun inspection namespace being set.&quot;</span>
            <span class="p">)</span>

        <span class="n">inspection_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span>
            <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;inspection&quot;</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">specification</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;identifier&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_INFRA_NAMESPACE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infra_namespace</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;AMUN_INSPECTION_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inspection_id</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;AMUN_BUILD_CPU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specification</span><span class="p">[</span><span class="s2">&quot;build&quot;</span><span class="p">][</span><span class="s2">&quot;requests&quot;</span><span class="p">][</span>
            <span class="s2">&quot;cpu&quot;</span>
        <span class="p">]</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;AMUN_BUILD_MEMORY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specification</span><span class="p">[</span><span class="s2">&quot;build&quot;</span><span class="p">][</span><span class="s2">&quot;requests&quot;</span><span class="p">][</span>
            <span class="s2">&quot;memory&quot;</span>
        <span class="p">]</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;AMUN_RUN_CPU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specification</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="s2">&quot;requests&quot;</span><span class="p">][</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;AMUN_RUN_MEMORY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specification</span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">][</span><span class="s2">&quot;requests&quot;</span><span class="p">][</span>
            <span class="s2">&quot;memory&quot;</span>
        <span class="p">]</span>

        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_workflow_parameters_for_ceph</span><span class="p">()</span>
        <span class="n">workflow_parameters</span><span class="p">[</span><span class="s2">&quot;dockerfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dockerfile</span>
        <span class="c1"># Propagate raw specification to be placed on Ceph, not to submit escaped specification.</span>
        <span class="n">workflow_parameters</span><span class="p">[</span><span class="s2">&quot;specification&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">raw_specification</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">raw_specification</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">specification</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">workflow_parameters</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>

        <span class="k">if</span> <span class="s2">&quot;batch_size&quot;</span> <span class="ow">in</span> <span class="n">specification</span><span class="p">:</span>
            <span class="n">workflow_parameters</span><span class="p">[</span><span class="s2">&quot;batch-size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specification</span><span class="p">[</span><span class="s2">&quot;batch_size&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_inspection</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.get_solver_names"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_solver_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_solver_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Retrieve name of solvers available in installation.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Infra namespace is required in order to list solvers&quot;</span>
            <span class="p">)</span>

        <span class="n">cm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_configmap</span><span class="p">(</span><span class="s2">&quot;solvers&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">)</span>
        <span class="n">solvers</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cm</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;solvers&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">solvers</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No solvers found in solvers ConfigMap&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">solvers</span></div>

<div class="viewcode-block" id="OpenShift.schedule_all_solvers"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_all_solvers">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_all_solvers</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">packages</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">indexes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">transitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule all solvers for the given packages.&quot;&quot;&quot;</span>
        <span class="n">solver_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">solver_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_solver_names</span><span class="p">():</span>
            <span class="n">solver_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule_solver</span><span class="p">(</span>
                <span class="n">packages</span><span class="o">=</span><span class="n">packages</span><span class="p">,</span>
                <span class="n">solver</span><span class="o">=</span><span class="n">solver_name</span><span class="p">,</span>
                <span class="n">indexes</span><span class="o">=</span><span class="n">indexes</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
                <span class="n">transitive</span><span class="o">=</span><span class="n">transitive</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">solver_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">solver_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solver_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">solver_ids</span></div>

<div class="viewcode-block" id="OpenShift.schedule_solver"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_solver">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_solver</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">packages</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">solver</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">indexes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">transitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule the given solver.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to schedule solver job without middletier namespace being set&quot;</span>
            <span class="p">)</span>

        <span class="n">workflow_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="n">solver</span><span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;THOTH_SOLVER_WORKFLOW_ID&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_SOLVER_NAME&quot;</span><span class="p">:</span> <span class="n">solver</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_SOLVER_PACKAGES&quot;</span><span class="p">:</span> <span class="n">packages</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">),</span>
            <span class="s2">&quot;THOTH_SOLVER_NO_TRANSITIVE&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">transitive</span><span class="p">),</span>
            <span class="s2">&quot;THOTH_SOLVER_INDEXES&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span> <span class="k">if</span> <span class="n">indexes</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_LOG_SOLVER&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_workflow_parameters_for_ceph</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_solver</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.schedule_revsolver"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_revsolver">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_revsolver</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">package_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule reverse solver.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to schedule reverse solver without middletier namespace being set&quot;</span>
            <span class="p">)</span>

        <span class="n">workflow_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;revsolver&quot;</span><span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;THOTH_REVSOLVER_WORKFLOW_ID&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_REVSOLVER_PACKAGE_NAME&quot;</span><span class="p">:</span> <span class="n">package_name</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_REVSOLVER_PACKAGE_VERSION&quot;</span><span class="p">:</span> <span class="n">package_version</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_LOG_REVSOLVER&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_workflow_parameters_for_ceph</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_revsolver</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.schedule_package_extract"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_package_extract">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_package_extract</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">environment_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">is_external</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">origin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">registry_user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">registry_password</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verify_tls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule package extract workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to schedule package extract job without middletier namespace being set&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">environment_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;runtime&quot;</span><span class="p">,</span> <span class="s2">&quot;buildtime&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unknown environment type </span><span class="si">%r</span><span class="s2">, has to be runtime or buildtime&quot;</span>
            <span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;THOTH_LOG_PACKAGE_EXTRACT&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_ANALYZED_IMAGE&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_ANALYZER_NO_TLS_VERIFY&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">verify_tls</span><span class="p">),</span>
            <span class="s2">&quot;THOTH_PACKAGE_EXTRACT_JOB_ID&quot;</span><span class="p">:</span> <span class="n">job_id</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;package-extract&quot;</span><span class="p">),</span>
            <span class="s2">&quot;THOTH_DOCUMENT_ID&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_PACKAGE_EXTRACT_METADATA&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span>
                    <span class="s2">&quot;environment_type&quot;</span><span class="p">:</span> <span class="n">environment_type</span><span class="p">,</span>
                    <span class="s2">&quot;is_external&quot;</span><span class="p">:</span> <span class="n">is_external</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">registry_user</span> <span class="ow">and</span> <span class="n">registry_password</span><span class="p">:</span>
            <span class="n">template_parameters</span><span class="p">[</span>
                <span class="s2">&quot;THOTH_REGISTRY_CREDENTIALS&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">registry_user</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">registry_password</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_workflow_parameters_for_ceph</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_package_extract</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.create_config_map"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.create_config_map">[docs]</a>    <span class="k">def</span> <span class="nf">create_config_map</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">configmap_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a ConfigMap in the given namespace.&quot;&quot;&quot;</span>
        <span class="n">v1_configmaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;ConfigMap&quot;</span>
        <span class="p">)</span>
        <span class="n">v1_configmaps</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">body</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;apiVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;v1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;ConfigMap&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">labels</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">configmap_name</span><span class="p">,</span>
                    <span class="s2">&quot;namespace&quot;</span><span class="p">:</span> <span class="n">namespace</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">configmap_name</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_schedule_workflow</span><span class="p">(</span>
        <span class="n">workflow</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule an Argo Workflow.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">workflow</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>

<div class="viewcode-block" id="OpenShift.generate_id"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.generate_id">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generate_id</span><span class="p">(</span>
        <span class="n">prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate an identifier.&quot;&quot;&quot;</span>
        <span class="c1"># A very first method used &#39;generatedName&#39; in ImageStream configuration,</span>
        <span class="c1"># but it looks like there is a bug in OpenShift as it did not generated any</span>
        <span class="c1"># name and failed with regexp issues (that were not related to the</span>
        <span class="c1"># generateName configuration).</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%08x</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;-</span><span class="si">%08x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;-</span><span class="si">%08x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.schedule_dependency_monkey"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_dependency_monkey">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_dependency_monkey</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">requirements</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">pipeline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">predictor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">predictor_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stack_output</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">runtime_environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">decision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit_latest_versions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule a dependency monkey run.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to schedule dependency monkey without middletier namespace being set&quot;</span>
            <span class="p">)</span>

        <span class="n">job_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;dependency-monkey&quot;</span><span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;THOTH_ADVISER_REQUIREMENTS&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">requirements</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">),</span>
            <span class="s2">&quot;THOTH_ADVISER_RUNTIME_ENVIRONMENT&quot;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">runtime_environment</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">runtime_environment</span><span class="p">),</span>
            <span class="s2">&quot;THOTH_AMUN_CONTEXT&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">),</span>
            <span class="s2">&quot;THOTH_DEPENDENCY_MONKEY_STACK_OUTPUT&quot;</span><span class="p">:</span> <span class="n">stack_output</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_DEPENDENCY_MONKEY_DRY_RUN&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">dry_run</span><span class="p">)),</span>
            <span class="s2">&quot;THOTH_LOG_ADVISER&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_DEPENDENCY_MONKEY_JOB_ID&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_DOCUMENT_ID&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_ADVISER_PIPELINE&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span> <span class="k">if</span> <span class="n">pipeline</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_ADVISER_PREDICTOR&quot;</span><span class="p">:</span> <span class="n">predictor</span> <span class="ow">or</span> <span class="s2">&quot;AUTO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_ADVISER_PREDICTOR_CONFIG&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">predictor_config</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">predictor_config</span>
            <span class="k">else</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">decision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template_parameters</span><span class="p">[</span>
                <span class="s2">&quot;THOTH_DEPENDENCY_MONKEY_DECISION_TYPE&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">decision</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_DEPENDENCY_MONKEY_SEED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>

        <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_DEPENDENCY_MONKEY_COUNT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

        <span class="k">if</span> <span class="n">limit_latest_versions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template_parameters</span><span class="p">[</span>
                <span class="s2">&quot;THOTH_ADVISER_LIMIT_LATEST_VERSIONS&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">limit_latest_versions</span>

        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_workflow_parameters_for_ceph</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_dependency_monkey</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.schedule_build_analysis"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_build_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_build_analysis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">output_image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">base_image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">registry_user</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">registry_password</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">registry_verify_tls</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">environment_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">origin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule a build analysis workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to schedule build report without middletier namespace being set&quot;</span>
            <span class="p">)</span>

        <span class="n">workflow_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;build-analysis&quot;</span><span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;THOTH_BUILD_ANALYSIS_WORKFLOW_ID&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_BUILD_ANALYSIS_OUTPUT_IMAGE&quot;</span><span class="p">:</span> <span class="n">output_image</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_BUILD_ANALYSIS_BASE_IMAGE&quot;</span><span class="p">:</span> <span class="n">base_image</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_BUILD_ANALYSIS_REGISTRY_USER&quot;</span><span class="p">:</span> <span class="n">registry_user</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_BUILD_ANALYSIS_REGISTRY_PASSWORD&quot;</span><span class="p">:</span> <span class="n">registry_password</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_BUILD_ANALYSIS_REGISTRY_VERIFY_TLS&quot;</span><span class="p">:</span> <span class="n">registry_verify_tls</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_BUILD_ANALYSIS_ENVIRONMENT_TYPE&quot;</span><span class="p">:</span> <span class="n">environment_type</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_BUILD_ANALYSIS_ORIGIN&quot;</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_workflow_parameters_for_ceph</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_build_analysis</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_verify_thoth_integration</span><span class="p">(</span><span class="n">source_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Verify if Thoth integration exists.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">source_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ThothAdviserIntegrationEnum</span><span class="o">.</span><span class="n">__members__</span>
            <span class="ow">and</span> <span class="n">source_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="n">NotKnownThothIntegration</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;This integration </span><span class="si">{</span><span class="n">source_type</span><span class="si">}</span><span class="s2"> is not provided </span><span class="se">\</span>
<span class="s2">                    in Thoth: </span><span class="si">{</span><span class="n">ThothAdviserIntegrationEnum</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="OpenShift.verify_github_app_inputs"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.verify_github_app_inputs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">verify_github_app_inputs</span><span class="p">(</span>
        <span class="n">github_event_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">github_check_run_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">github_installation_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">github_base_repo_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">origin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Verify if Thoth GitHub App integration inputs are correct.&quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">QebHwtInputsMissing</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Not all inputs to schedule Qeb-Hwt GitHub App are provided: </span><span class="si">{</span><span class="n">parameters</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.verify_kebechet_inputs"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.verify_kebechet_inputs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">verify_kebechet_inputs</span><span class="p">(</span><span class="n">origin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Verify if Thoth Kebechet integration inputs are correct.&quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">KebechetInputsMissing</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Not all inputs to schedule Kebechet are provided: </span><span class="si">{</span><span class="n">parameters</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.verify_integration_inputs"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.verify_integration_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">verify_integration_inputs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ThothAdviserIntegrationEnum</span><span class="p">],</span>
        <span class="n">github_event_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">github_check_run_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">github_installation_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">github_base_repo_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">origin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Verify if inputs for registered Thoth integrations are correct.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">source_type</span> <span class="ow">is</span> <span class="n">ThothAdviserIntegrationEnum</span><span class="o">.</span><span class="n">GITHUB_APP</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_github_app_inputs</span><span class="p">(</span>
                <span class="n">github_event_type</span><span class="o">=</span><span class="n">github_event_type</span><span class="p">,</span>
                <span class="n">github_check_run_id</span><span class="o">=</span><span class="n">github_check_run_id</span><span class="p">,</span>
                <span class="n">github_installation_id</span><span class="o">=</span><span class="n">github_installation_id</span><span class="p">,</span>
                <span class="n">github_base_repo_url</span><span class="o">=</span><span class="n">github_base_repo_url</span><span class="p">,</span>
                <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">source_type</span> <span class="ow">is</span> <span class="n">ThothAdviserIntegrationEnum</span><span class="o">.</span><span class="n">KEBECHET</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_kebechet_inputs</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.schedule_adviser"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_adviser">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_adviser</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">application_stack</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">recommendation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">predictor_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">runtime_environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">library_usage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">origin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dev</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">github_event_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">github_check_run_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">github_installation_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">github_base_repo_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">re_run_adviser_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">source_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule an adviser run.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to schedule adviser without backend namespace being set&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">source_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verify_thoth_integration</span><span class="p">(</span><span class="n">source_type</span><span class="o">=</span><span class="n">source_type</span><span class="p">)</span>
        <span class="n">source_type_enum</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">ThothAdviserIntegrationEnum</span><span class="p">,</span> <span class="n">source_type</span><span class="p">)</span> <span class="k">if</span> <span class="n">source_type</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verify_integration_inputs</span><span class="p">(</span>
            <span class="n">source_type</span><span class="o">=</span><span class="n">source_type_enum</span><span class="p">,</span>
            <span class="n">github_event_type</span><span class="o">=</span><span class="n">github_event_type</span><span class="p">,</span>
            <span class="n">github_check_run_id</span><span class="o">=</span><span class="n">github_check_run_id</span><span class="p">,</span>
            <span class="n">github_installation_id</span><span class="o">=</span><span class="n">github_installation_id</span><span class="p">,</span>
            <span class="n">github_base_repo_url</span><span class="o">=</span><span class="n">github_base_repo_url</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">adviser_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;adviser&quot;</span><span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">application_stack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;requirements_lock&quot;</span><span class="p">):</span>
            <span class="n">template_parameters</span><span class="p">[</span>
                <span class="s2">&quot;THOTH_ADVISER_REQUIREMENTS_LOCKED&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">application_stack</span><span class="p">[</span><span class="s2">&quot;requirements_lock&quot;</span><span class="p">]</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_JOB_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adviser_id</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_DEV&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="k">if</span> <span class="n">dev</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_REQUIREMENTS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">application_stack</span><span class="p">[</span>
            <span class="s2">&quot;requirements&quot;</span>
        <span class="p">]</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_LIBRARY_USAGE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">library_usage</span><span class="p">)</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_LOG_ADVISER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span>
        <span class="n">template_parameters</span><span class="p">[</span>
            <span class="s2">&quot;THOTH_ADVISER_REQUIREMENTS_FORMAT&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">application_stack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;requirements_format&quot;</span><span class="p">,</span> <span class="s2">&quot;pipenv&quot;</span><span class="p">)</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_RECOMMENDATION_TYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recommendation_type</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_RUNTIME_ENVIRONMENT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="n">runtime_environment</span>
        <span class="p">)</span>
        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_PREDICTOR_CONFIG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">predictor_config</span><span class="p">)</span> <span class="k">if</span> <span class="n">predictor_config</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_METADATA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;github_event_type&quot;</span><span class="p">:</span> <span class="n">github_event_type</span><span class="p">,</span>
                <span class="s2">&quot;github_check_run_id&quot;</span><span class="p">:</span> <span class="n">github_check_run_id</span><span class="p">,</span>
                <span class="s2">&quot;github_installation_id&quot;</span><span class="p">:</span> <span class="n">github_installation_id</span><span class="p">,</span>
                <span class="s2">&quot;github_base_repo_url&quot;</span><span class="p">:</span> <span class="n">github_base_repo_url</span><span class="p">,</span>
                <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span>
                <span class="s2">&quot;re_run_adviser_id&quot;</span><span class="p">:</span> <span class="n">re_run_adviser_id</span><span class="p">,</span>
                <span class="s2">&quot;source_type&quot;</span><span class="p">:</span> <span class="n">source_type</span> <span class="k">if</span> <span class="n">source_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_LIMIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>

        <span class="k">if</span> <span class="n">count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">template_parameters</span><span class="p">[</span><span class="s2">&quot;THOTH_ADVISER_COUNT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_workflow_parameters_for_ceph</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_adviser</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_assign_workflow_parameters_for_ceph</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Check and assign workflow parameters for different services to interact with Ceph.&quot;&quot;&quot;</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ceph_bucket_prefix&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;THOTH_CEPH_BUCKET_PREFIX&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ceph_bucket_name&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;THOTH_CEPH_BUCKET&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ceph_host&quot;</span><span class="p">:</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;THOTH_S3_ENDPOINT_URL&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">netloc</span><span class="p">,</span>
            <span class="s2">&quot;deployment_name&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;THOTH_DEPLOYMENT_NAME&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">workflow_parameters</span>

<div class="viewcode-block" id="OpenShift.schedule_provenance_checker"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_provenance_checker">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_provenance_checker</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">application_stack</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">origin</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">whitelisted_sources</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Run provenance checks on the provided user input.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Running provenance checks requires backend namespace configuration&quot;</span>
            <span class="p">)</span>

        <span class="n">job_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;provenance-checker&quot;</span><span class="p">)</span>

        <span class="n">requirements</span> <span class="o">=</span> <span class="n">application_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;requirements&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span>
        <span class="n">requirements_locked</span> <span class="o">=</span> <span class="n">application_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;requirements_lock&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span>
        <span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;THOTH_ADVISER_REQUIREMENTS&quot;</span><span class="p">:</span> <span class="n">requirements</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_ADVISER_REQUIREMENTS_LOCKED&quot;</span><span class="p">:</span> <span class="n">requirements_locked</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_ADVISER_METADATA&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="n">origin</span><span class="p">}),</span>
            <span class="s2">&quot;THOTH_WHITELISTED_SOURCES&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">whitelisted_sources</span> <span class="ow">or</span> <span class="p">[]),</span>
            <span class="s2">&quot;THOTH_LOG_ADVISER&quot;</span><span class="p">:</span> <span class="s2">&quot;DEBUG&quot;</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_PROVENANCE_CHECKER_JOB_ID&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_DOCUMENT_ID&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_workflow_parameters_for_ceph</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_provenance_checker</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.schedule_qebhwt_workflow"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_qebhwt_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_qebhwt_workflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">github_event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">github_check_run_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">github_installation_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">github_base_repo_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">github_head_repo_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">revision</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule Workflow for Qeb-Hwt GitHub App..&quot;&quot;&quot;</span>
        <span class="n">workflow_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;qeb-hwt&quot;</span><span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;WORKFLOW_ID&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
            <span class="s2">&quot;GITHUB_EVENT_TYPE&quot;</span><span class="p">:</span> <span class="n">github_event_type</span><span class="p">,</span>
            <span class="s2">&quot;GITHUB_CHECK_RUN_ID&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">github_check_run_id</span><span class="p">),</span>
            <span class="s2">&quot;GITHUB_INSTALLATION_ID&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">github_installation_id</span><span class="p">),</span>
            <span class="s2">&quot;GITHUB_BASE_REPO_URL&quot;</span><span class="p">:</span> <span class="n">github_base_repo_url</span><span class="p">,</span>
            <span class="s2">&quot;GITHUB_HEAD_REPO_URL&quot;</span><span class="p">:</span> <span class="n">github_head_repo_url</span><span class="p">,</span>
            <span class="s2">&quot;ORIGIN&quot;</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span>
            <span class="s2">&quot;REVISION&quot;</span><span class="p">:</span> <span class="n">revision</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_HOST&quot;</span><span class="p">:</span> <span class="n">host</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_qebhwt</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.schedule_mi_workflow"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_mi_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_mi_workflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">repository</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule Meta-information Indicators Workflow.</span>

<span class="sd">        :param repository:str: GitHub repository in full name format: &lt;repo_owner&gt;/&lt;repo_name&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">workflow_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;mi&quot;</span><span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;WORKFLOW_ID&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span> <span class="s2">&quot;REPOSITORY&quot;</span><span class="p">:</span> <span class="n">repository</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_mi</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.schedule_kebechet_workflow"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_kebechet_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_kebechet_workflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">webhook_payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule Kebechet Workflow for a Webhook from GitHub App..&quot;&quot;&quot;</span>
        <span class="n">workflow_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;kebechet-job&quot;</span><span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;WORKFLOW_ID&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
            <span class="s2">&quot;WEBHOOK_PAYLOAD&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">webhook_payload</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_kebechet</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.schedule_security_indicator"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.schedule_security_indicator">[docs]</a>    <span class="k">def</span> <span class="nf">schedule_security_indicator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">python_package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">python_package_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">python_package_index</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">aggregation_function</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Schedule a security indicator run.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to schedule security-indicator without middletier namespace being set&quot;</span>
            <span class="p">)</span>

        <span class="n">security_indicator_id</span> <span class="o">=</span> <span class="n">job_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="s2">&quot;security-indicator&quot;</span><span class="p">)</span>
        <span class="n">template_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;THOTH_SECURITY_INDICATORS_JOB_ID&quot;</span><span class="p">:</span> <span class="n">security_indicator_id</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_SECURITY_INDICATORS_PACKAGE_NAME&quot;</span><span class="p">:</span> <span class="n">python_package_name</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_SECURITY_INDICATORS_PACKAGE_VERSION&quot;</span><span class="p">:</span> <span class="n">python_package_version</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_SECURITY_INDICATORS_PACKAGE_INDEX&quot;</span><span class="p">:</span> <span class="n">python_package_index</span><span class="p">,</span>
            <span class="s2">&quot;THOTH_SECURITY_INDICATORS_AGGREGATION_FUNCTION&quot;</span><span class="p">:</span> <span class="n">aggregation_function</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_workflow_parameters_for_ceph</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule_workflow</span><span class="p">(</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">submit_security_indicator</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;template_parameters&quot;</span><span class="p">:</span> <span class="n">template_parameters</span><span class="p">,</span>
                <span class="s2">&quot;workflow_parameters&quot;</span><span class="p">:</span> <span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_raise_on_invalid_response_size</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">label_selector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Expect that there is only one object type for the given item.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Application misconfiguration - number of templates available in namespace </span><span class="si">{</span><span class="n">namespace</span><span class="si">!r}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;is </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2">, should be 1: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;label selector: </span><span class="si">{</span><span class="n">label_selector</span><span class="si">!r}</span><span class="s2">, name: </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="c1"># TODO add name of template we were looking for...</span>

<div class="viewcode-block" id="OpenShift.oc_process"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.oc_process">[docs]</a>    <span class="k">def</span> <span class="nf">oc_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Process the given template in OpenShift.&quot;&quot;&quot;</span>
        <span class="c1"># TODO: This does not work - see issue reported upstream:</span>
        <span class="c1">#   https://github.com/openshift/openshift-restclient-python/issues/190</span>
        <span class="c1"># return TemplateOpenshiftIoApi().create_namespaced_processed_template_v1(namespace, template)</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/apis/template.openshift.io/v1/namespaces/</span><span class="si">{}</span><span class="s2">/processedtemplates&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift_api_url</span><span class="p">,</span> <span class="n">namespace</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">),</span>
                <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kubernetes_verify_tls</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;OpenShift master response template (</span><span class="si">%d</span><span class="s2">): </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to process template: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="OpenShift.parse_cpu_spec"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.parse_cpu_spec">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">parse_cpu_spec</span><span class="p">(</span><span class="n">cpu_spec</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Parse the given CPU requirement as used by OpenShift/Kubernetes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpu_spec</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cpu_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">):</span>
            <span class="n">cpu_spec</span> <span class="o">=</span> <span class="n">cpu_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">cpu_spec</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="k">if</span> <span class="n">cpu_spec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">cpu_spec</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.parse_memory_spec"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.parse_memory_spec">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">parse_memory_spec</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Parse the given CPU requirement as used by OpenShift/Kubernetes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">memory_spec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">**</span> <span class="mi">6</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">**</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">**</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Ei&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">**</span> <span class="mi">6</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Pi&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">**</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Ti&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">**</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Gi&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">**</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Mi&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">memory_spec</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;Ki&quot;</span><span class="p">):</span>
            <span class="n">parsed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">memory_spec</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">parsed</span> <span class="o">*</span> <span class="mi">1024</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot parse memory specification from </span><span class="si">{</span><span class="n">memory_spec</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenShift.get_job_status_count"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_job_status_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_job_status_count</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">label_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Count the number of Jobs per status in a specific namespace.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jobs</span><span class="p">(</span><span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;created&quot;</span><span class="p">,</span>
            <span class="s2">&quot;active&quot;</span><span class="p">,</span>
            <span class="s2">&quot;failed&quot;</span><span class="p">,</span>
            <span class="s2">&quot;succeeded&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pending&quot;</span><span class="p">,</span>
            <span class="s2">&quot;retry&quot;</span><span class="p">,</span>
            <span class="s2">&quot;waiting&quot;</span><span class="p">,</span>
            <span class="s2">&quot;started&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Initialize</span>
        <span class="n">jobs_status_count</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Count jobs per status</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]:</span>
            <span class="n">jobs_status_count</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="s2">&quot;succeeded&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">jobs_status_count</span><span class="p">[</span><span class="s2">&quot;succeeded&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="s2">&quot;failed&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">jobs_status_count</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="s2">&quot;active&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">jobs_status_count</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="s2">&quot;pending&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">jobs_status_count</span><span class="p">[</span><span class="s2">&quot;pending&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">jobs_status_count</span><span class="p">[</span><span class="s2">&quot;waiting&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="s2">&quot;startTime&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="n">jobs_status_count</span><span class="p">[</span><span class="s2">&quot;started&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="s2">&quot;BackoffLimitExceeded&quot;</span>
                        <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="s2">&quot;conditions&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;reason&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">jobs_status_count</span><span class="p">[</span><span class="s2">&quot;retry&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">excptn</span><span class="p">:</span>
                    <span class="n">_LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown job status </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                    <span class="n">_LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">excptn</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jobs_status_count</span></div>

<div class="viewcode-block" id="OpenShift.get_workflow"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">label_selector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get Workflow from a namespace, use one of name or label_selector to identify which one to get.&quot;&quot;&quot;</span>
        <span class="n">wf</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label_selector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Only one of `name` or `label_selector` can be provided.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Ignoring `label_selector=</span><span class="si">{</span><span class="n">label_selector</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;argoproj.io/v1alpha1&quot;</span><span class="p">,</span>
                    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;Workflow&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;workflows&quot;</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;OpenShift response for getting template by name </span><span class="si">%r</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="p">,</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">OpenShiftNotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The given Workflow </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> could not be found&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

            <span class="n">wf</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">label_selector</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocp_client</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;argoproj.io/v1alpha1&quot;</span><span class="p">,</span>
                    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;Workflow&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;workflows&quot;</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
                    <span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;OpenShift response for getting template by label_selector </span><span class="si">%r</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">label_selector</span><span class="p">,</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">OpenShiftNotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The given Workflow containing label </span><span class="si">{</span><span class="n">label_selector</span><span class="si">}</span><span class="s2"> could not be found&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_on_invalid_response_size</span><span class="p">(</span>
                <span class="n">response</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span>
            <span class="p">)</span>

            <span class="n">wf</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s2">&quot;items&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either `name` or `label_selector` has to be provided.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wf</span></div>

<div class="viewcode-block" id="OpenShift.get_workflow_status_report"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_workflow_status_report">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflow_status_report</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">label_selector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Get workflow status report, derived from workflow status.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wf_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflow_status</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span>
            <span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;finished_at&quot;</span><span class="p">:</span> <span class="n">wf_status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;finishedAt&quot;</span><span class="p">),</span>
                <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;started_at&quot;</span><span class="p">:</span> <span class="n">wf_status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;startedAt&quot;</span><span class="p">),</span>
                <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">wf_status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;phase&quot;</span><span class="p">,</span> <span class="s2">&quot;pending&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="n">NotFoundException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Requested status for analysis </span><span class="si">{</span><span class="n">workflow_id</span><span class="si">!r}</span><span class="s2"> was not found&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="OpenShift.get_workflow_status"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.openshift.OpenShift.get_workflow_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflow_status</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">label_selector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get a Workflow status, use one of name or label_selector to identify which one to get.&quot;&quot;&quot;</span>
        <span class="n">wf</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflow</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span>
        <span class="p">)</span>
        <span class="n">to_ret</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">to_ret</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation index</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

  
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>

  </body>
</html>