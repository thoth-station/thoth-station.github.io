
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>thoth.common.workflows &#8212; Thoth Common 0.17.2 documentation</title>
    <link rel="stylesheet" href="../../../_static/nameko.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-123174547-2']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Thoth Common 0.17.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for thoth.common.workflows</h1><div class="highlight"><pre>
<span></span><span class="c1"># thoth-common</span>
<span class="c1"># Copyright(C) 2019, 2020 Marek Cermak</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and / or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;Workflow management for Thoth.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Mapping</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">attrdict</span> <span class="kn">import</span> <span class="n">AttrDict</span>

<span class="kn">from</span> <span class="nn">argo.workflows</span> <span class="kn">import</span> <span class="n">client</span>
<span class="kn">from</span> <span class="nn">argo.workflows</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">ConfigurationError</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">WorkflowError</span>

<span class="kn">from</span> <span class="nn">.helpers</span> <span class="kn">import</span> <span class="n">to_camel_case</span>
<span class="kn">from</span> <span class="nn">.helpers</span> <span class="kn">import</span> <span class="n">to_snake_case</span>

<span class="kn">from</span> <span class="nn">.openshift</span> <span class="kn">import</span> <span class="n">OpenShift</span>

<span class="n">_LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="Workflow"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.Workflow">[docs]</a><span class="k">class</span> <span class="nc">Workflow</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Workflow</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="sd">&quot;&quot;&quot;Argo Workflow instance.</span>

<span class="sd">    This is a subclass of argo.workflows V1alpha1Workflow model</span>
<span class="sd">    which provides a convenient set of methods to make workflow</span>
<span class="sd">    management easier.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Metadata</span><span class="p">,</span>
        <span class="n">spec</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">V1alpha1WorkflowSpec</span><span class="p">,</span>
        <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">V1alpha1WorkflowStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize Workflow instance.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">api_version</span><span class="o">=</span><span class="n">api_version</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validated</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get Workflow name.&quot;&quot;&quot;</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get Workflow ID.&quot;&quot;&quot;</span>
        <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="s2">&quot;generate_name&quot;</span><span class="p">)</span>
        <span class="n">digest</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">OpenShift</span><span class="o">.</span><span class="n">generate_id</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">digest</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validated</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return whether this workflow has been validated.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__validated</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compare workflows for equality.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compute hash of this Workflow.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_str</span><span class="p">()</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>

<div class="viewcode-block" id="Workflow.from_file"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.Workflow.from_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a Workflow from a file.&quot;&quot;&quot;</span>
        <span class="n">wf_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

        <span class="n">wf</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">wf_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span></div>

<div class="viewcode-block" id="Workflow.from_url"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.Workflow.from_url">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_url</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a Workflow from a remote file.&quot;&quot;&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;https://raw.githubusercontent.com/argoproj/argo/master/examples/hello-world.yaml&quot;</span>
        <span class="p">)</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="n">wf</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span></div>

<div class="viewcode-block" id="Workflow.from_dict"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.Workflow.from_dict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">wf</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a Workflow from a dict.&quot;&quot;&quot;</span>
        <span class="c1"># work around validation issues and allow empty status</span>
        <span class="n">wf</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">wf</span><span class="p">),</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span></div>

<div class="viewcode-block" id="Workflow.from_string"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.Workflow.from_string">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">wf</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a Workflow from a YAML string.&quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">wf</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__deserialize</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Deserialize given object into a Workflow instance.&quot;&quot;&quot;</span>
        <span class="n">wf</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Workflow</span>
        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s2">&quot;AttributeDict&quot;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">body</span><span class="p">)</span>

            <span class="n">wf</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">ApiClient</span><span class="p">()</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Workflow</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Validation is turned off. This may result in missing or invalid attributes.&quot;</span>
            <span class="p">)</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="n">to_snake_case</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

            <span class="n">wf</span> <span class="o">=</span> <span class="n">AttrDict</span><span class="p">(</span><span class="o">**</span><span class="n">aux</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">api_version</span><span class="o">=</span><span class="n">wf</span><span class="o">.</span><span class="n">api_version</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wf</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">wf</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">spec</span><span class="o">=</span><span class="n">wf</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">wf</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>  <span class="c1"># a small hack to overcome validation</span>
        <span class="p">)</span>

        <span class="n">instance</span><span class="o">.</span><span class="n">__validated</span> <span class="o">=</span> <span class="n">validate</span>

        <span class="k">return</span> <span class="n">instance</span></div>


<div class="viewcode-block" id="WorkflowManager"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager">[docs]</a><span class="k">class</span> <span class="nc">WorkflowManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Argo Workflow manager.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">openshift</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OpenShift</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">openshift_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize WorkflowManager instance.&quot;&quot;&quot;</span>
        <span class="n">ocp_config</span> <span class="o">=</span> <span class="n">openshift_config</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span> <span class="o">=</span> <span class="n">openshift</span> <span class="ow">or</span> <span class="n">OpenShift</span><span class="p">(</span><span class="o">**</span><span class="n">ocp_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">V1alpha1Api</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">ApiClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">configuration</span><span class="p">))</span>

<div class="viewcode-block" id="WorkflowManager.get_workflow_template"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.get_workflow_template">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflow_template</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">label_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get Workflow template.&quot;&quot;&quot;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">_get_template</span><span class="p">(</span><span class="n">label_selector</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">set_template_parameters</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">oc_process</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span></div>

<div class="viewcode-block" id="WorkflowManager.get_workflow"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.get_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get Workflow in namespace by name.&quot;&quot;&quot;</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_namespaced_workflow</span><span class="p">(</span>
            <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="WorkflowManager.get_workflows"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.get_workflows">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflows</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">label_selector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get Workflows in namespace.&quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;self&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">label_selector</span><span class="p">:</span>
            <span class="n">parameters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;label_selector&quot;</span><span class="p">)</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">list_namespaced_workflows</span><span class="p">(</span>
            <span class="o">**</span><span class="n">parameters</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="WorkflowManager.get_workflow_info"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.get_workflow_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflow_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get Workflow in namespace by name.&quot;&quot;&quot;</span>
        <span class="n">workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflow</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">workflow_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_workflow_info</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">workflow_main</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">workflow_main</span><span class="p">}</span></div>

<div class="viewcode-block" id="WorkflowManager.get_workflows_info"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.get_workflows_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflows_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">label_selector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get workflows info from a specific namespace.&quot;&quot;&quot;</span>
        <span class="n">workflows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflows</span><span class="p">(</span>
            <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span>
        <span class="p">)</span>
        <span class="n">workflow_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">workflow</span> <span class="ow">in</span> <span class="n">workflows</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]:</span>

            <span class="n">workflow_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_workflow_info</span><span class="p">(</span><span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">)</span>

            <span class="n">workflow_data</span><span class="p">[</span><span class="n">workflow</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">workflow_main</span>

        <span class="k">return</span> <span class="n">workflow_data</span></div>

    <span class="k">def</span> <span class="nf">_collect_workflow_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Collect Workflow info.&quot;&quot;&quot;</span>
        <span class="n">started_at</span> <span class="o">=</span> <span class="n">workflow</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="s2">&quot;started_at&quot;</span><span class="p">]</span>
        <span class="n">finished_at</span> <span class="o">=</span> <span class="n">workflow</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="s2">&quot;finished_at&quot;</span><span class="p">]</span>

        <span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">started_at</span> <span class="ow">and</span> <span class="n">finished_at</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">finished_at</span> <span class="o">-</span> <span class="n">started_at</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

        <span class="n">tasks_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_tasks_names</span><span class="p">(</span><span class="n">templates</span><span class="o">=</span><span class="n">workflow</span><span class="p">[</span><span class="s2">&quot;spec&quot;</span><span class="p">][</span><span class="s2">&quot;templates&quot;</span><span class="p">])</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collect_workflows_tasks_info</span><span class="p">(</span>
            <span class="n">nodes</span><span class="o">=</span><span class="n">workflow</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">tasks_names</span><span class="o">=</span><span class="n">tasks_names</span>
        <span class="p">)</span>

        <span class="n">workflow_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">workflow</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">workflow</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;labels&quot;</span><span class="p">],</span>
            <span class="s2">&quot;started_at&quot;</span><span class="p">:</span> <span class="n">started_at</span><span class="p">,</span>
            <span class="s2">&quot;finished_at&quot;</span><span class="p">:</span> <span class="n">finished_at</span><span class="p">,</span>
            <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
            <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="n">workflow</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="s2">&quot;phase&quot;</span><span class="p">],</span>
            <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">nodes</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">workflow_info</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_collect_tasks_names</span><span class="p">(</span><span class="n">templates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Collect tasks names from Workflow template.&quot;&quot;&quot;</span>
        <span class="n">tasks_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="c1"># TODO: Extend to other structures beside dag and consider also steps</span>
            <span class="k">if</span> <span class="s2">&quot;dag&quot;</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;dag&quot;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;dag&quot;</span><span class="p">][</span><span class="s2">&quot;tasks&quot;</span><span class="p">]:</span>
                        <span class="n">tasks_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tasks_names</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_collect_workflows_tasks_info</span><span class="p">(</span>
        <span class="n">nodes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">tasks_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Collect info about tasks in the Workflow.&quot;&quot;&quot;</span>
        <span class="n">nodes_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nodes_info</span>

        <span class="k">for</span> <span class="n">pod_id</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">tasks_names</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;started_at&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;finished_at&quot;</span><span class="p">]:</span>
                    <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">node</span><span class="p">[</span><span class="s2">&quot;finished_at&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;started_at&quot;</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

                <span class="n">nodes_info</span><span class="p">[</span><span class="n">pod_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;pod_id&quot;</span><span class="p">:</span> <span class="n">pod_id</span><span class="p">,</span>
                    <span class="s2">&quot;display_name&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;started_at&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;started_at&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;finished_at&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;finished_at&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                    <span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;phase&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">],</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="n">nodes_info</span>

<div class="viewcode-block" id="WorkflowManager.get_workflow_and_tasks_status"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.get_workflow_and_tasks_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflow_and_tasks_status</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get workflow and tasks status from a specific namespace.&quot;&quot;&quot;</span>
        <span class="n">workflow_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflow_info</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_workflows_info</span><span class="p">(</span><span class="n">workflow_info</span><span class="p">)</span></div>

<div class="viewcode-block" id="WorkflowManager.get_workflows_and_tasks_status"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.get_workflows_and_tasks_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_workflows_and_tasks_status</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_selector</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get workflows and tasks status from a specific namespace.&quot;&quot;&quot;</span>
        <span class="n">workflows_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflows_info</span><span class="p">(</span>
            <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span> <span class="n">label_selector</span><span class="o">=</span><span class="n">label_selector</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_workflows_info</span><span class="p">(</span><span class="n">workflows_info</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_analyze_workflows_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflows_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Analyze workflows info.&quot;&quot;&quot;</span>
        <span class="n">workflows_status</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">workflow_id</span><span class="p">,</span> <span class="n">workflow_data</span> <span class="ow">in</span> <span class="n">workflows_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">workflow_phase</span> <span class="o">=</span> <span class="n">workflow_data</span><span class="p">[</span><span class="s2">&quot;phase&quot;</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">workflow_data</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
            <span class="n">workflow_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_component_label</span><span class="p">(</span>
                <span class="n">workflow_id</span><span class="o">=</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
            <span class="p">)</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">workflow_data</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span>
            <span class="n">workflows_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_workflows_status</span><span class="p">(</span>
                <span class="n">workflows_status</span><span class="o">=</span><span class="n">workflows_status</span><span class="p">,</span>
                <span class="n">workflow_type</span><span class="o">=</span><span class="n">workflow_type</span><span class="p">,</span>
                <span class="n">workflow_phase</span><span class="o">=</span><span class="n">workflow_phase</span><span class="p">,</span>
                <span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">workflows_status</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_component_label</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check if component label is present in order to know which component is running in the workflow.&quot;&quot;&quot;</span>
        <span class="n">workflow_type</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;component&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">workflow_type</span><span class="p">:</span>
            <span class="n">to_ret</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">workflow_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">to_ret</span> <span class="o">=</span> <span class="s2">&quot;missing_component_label&quot;</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing component label for workflow: </span><span class="si">{</span><span class="n">workflow_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">to_ret</span>

    <span class="k">def</span> <span class="nf">_update_workflows_status</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">workflows_status</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">workflow_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">workflow_phase</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Update workflows status collection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">workflow_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">workflows_status</span><span class="p">:</span>
            <span class="n">workflows_status</span><span class="p">[</span><span class="n">workflow_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="n">workflow_type</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s2">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">workflow_phase</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">workflow_phase</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">workflows_status</span><span class="p">[</span><span class="n">workflow_type</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">workflows_status</span><span class="p">[</span><span class="n">workflow_type</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="n">workflow_phase</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">workflows_status</span><span class="p">[</span><span class="n">workflow_type</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="n">workflow_phase</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Unknown&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">workflows_status</span><span class="p">[</span><span class="n">workflow_type</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">workflows_status</span><span class="p">[</span><span class="n">workflow_type</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="s2">&quot;Unknown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">workflows_status</span><span class="p">[</span><span class="n">workflow_type</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">][</span><span class="s2">&quot;Unknown&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">workflows_status</span><span class="p">[</span><span class="n">workflow_type</span><span class="p">][</span><span class="s2">&quot;tasks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_tasks_status</span><span class="p">(</span>
            <span class="n">workflows_status</span><span class="p">[</span><span class="n">workflow_type</span><span class="p">][</span><span class="s2">&quot;tasks&quot;</span><span class="p">],</span> <span class="n">nodes</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflows_status</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_update_tasks_status</span><span class="p">(</span>
        <span class="n">task_status</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Update tasks status collection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">task_status</span>

        <span class="k">for</span> <span class="n">pod_id</span><span class="p">,</span> <span class="n">pod_data</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">task_name</span> <span class="o">=</span> <span class="n">pod_data</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">task_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">task_status</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">task_status</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">pod_phase</span> <span class="o">=</span> <span class="n">pod_data</span><span class="p">[</span><span class="s2">&quot;phase&quot;</span><span class="p">]</span>
                <span class="n">task_status</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="n">pod_phase</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pod_phase</span> <span class="o">=</span> <span class="n">pod_data</span><span class="p">[</span><span class="s2">&quot;phase&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pod_phase</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">task_status</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">task_status</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="n">pod_phase</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">task_status</span><span class="p">[</span><span class="n">task_name</span><span class="p">][</span><span class="n">pod_phase</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">task_status</span>

<div class="viewcode-block" id="WorkflowManager.submit_workflow"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_workflow">[docs]</a>    <span class="k">def</span> <span class="nf">submit_workflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">wf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Workflow</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit an Argo Workflow to a given namespace.</span>

<span class="sd">        :returns: Workflow ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Workflow</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">Union</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Workflow</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">new_parameters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Parameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
            <span class="n">new_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="s2">&quot;arguments&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">arguments</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># overridden</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">WorkflowError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required workflow parameter </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">new_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="n">wf</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">new_parameters</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="s2">&quot;validated&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;The Workflow has not been previously validated.&quot;</span>
                <span class="s2">&quot;Sanitizing for serialization.&quot;</span>
            <span class="p">)</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">to_camel_case</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">api_client</span><span class="o">.</span><span class="n">sanitize_for_serialization</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>

        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Submitting workflow: </span><span class="si">{</span><span class="n">body</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># submit the workflow</span>
        <span class="n">created</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">V1alpha1Workflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">create_namespaced_workflow</span><span class="p">(</span>  <span class="c1"># noqa</span>
            <span class="n">namespace</span><span class="p">,</span> <span class="n">body</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">wf</span><span class="o">.</span><span class="n">name</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_workflow_from_template"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_workflow_from_template">[docs]</a>    <span class="k">def</span> <span class="nf">submit_workflow_from_template</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">label_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_namespace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Retrieve and Submit Workflow from an OpenShift template.</span>

<span class="sd">        :param namespace: namespace to lookup the template in</span>

<span class="sd">            If `workflow_namespace` is not provided, this namespace</span>
<span class="sd">            is also implicitly the namespace where the workflow is submitted</span>

<span class="sd">        :param label_selector: selector for the template, i.e. &#39;template=workflow-template&#39;</span>
<span class="sd">        :param template_parameters: parameters for the template</span>
<span class="sd">        :param workflow_parameters: parameters for the workflow</span>
<span class="sd">        :param workflow_namespace: namespace to submit the workflow to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workflow_template</span><span class="p">(</span>
            <span class="n">namespace</span><span class="p">,</span> <span class="n">label_selector</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">template_parameters</span>
        <span class="p">)</span>

        <span class="n">workflow_object</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">workflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">workflow_object</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">workflow_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow</span><span class="p">(</span>
            <span class="n">workflow_namespace</span> <span class="ow">or</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">workflow_parameters</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_inspection"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_inspection">[docs]</a>    <span class="k">def</span> <span class="nf">submit_inspection</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_hw_template</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit the Inspection Workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">amun_infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">amun_inspection_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Inspection namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_hw_template</span><span class="p">:</span>
            <span class="n">label_selector</span> <span class="o">=</span> <span class="s2">&quot;template=amun-inspection-workflow-with-cpu&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label_selector</span> <span class="o">=</span> <span class="s2">&quot;template=amun-inspection-workflow&quot;</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">template_parameters</span><span class="p">[</span>
            <span class="s2">&quot;THOTH_INFRA_NAMESPACE&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">amun_infra_namespace</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">amun_infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">amun_inspection_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_adviser"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_adviser">[docs]</a>    <span class="k">def</span> <span class="nf">submit_adviser</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit Adviser Workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">backend_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Backend namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=adviser&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">backend_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_package_extract"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_package_extract">[docs]</a>    <span class="k">def</span> <span class="nf">submit_package_extract</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit package-extract workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Middletier namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=package-extract&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_dependency_monkey"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_dependency_monkey">[docs]</a>    <span class="k">def</span> <span class="nf">submit_dependency_monkey</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit Dependency Monkey workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Middletier namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=dependency-monkey&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_provenance_checker"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_provenance_checker">[docs]</a>    <span class="k">def</span> <span class="nf">submit_provenance_checker</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit provenance checker workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">backend_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Backend namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=provenance-checker&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_kebechet"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_kebechet">[docs]</a>    <span class="k">def</span> <span class="nf">submit_kebechet</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit Kebechet Workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">backend_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Backend namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=kebechet&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">backend_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_solver"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_solver">[docs]</a>    <span class="k">def</span> <span class="nf">submit_solver</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit Solver Workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Middletier namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=solver&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_revsolver"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_revsolver">[docs]</a>    <span class="k">def</span> <span class="nf">submit_revsolver</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit reverse solver workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Middletier namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=revsolver&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_thamos"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_thamos">[docs]</a>    <span class="k">def</span> <span class="nf">submit_thamos</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit Thamos Advise Workflow for Qeb-Hwt GitHub App.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">backend_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Backend namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=qeb-hwt&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">backend_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_security_indicator"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_security_indicator">[docs]</a>    <span class="k">def</span> <span class="nf">submit_security_indicator</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit Security Indicator Workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Middletier namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=security-indicators&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_mi"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_mi">[docs]</a>    <span class="k">def</span> <span class="nf">submit_mi</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit Meta-information Indicators workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Middletier namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=mi&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div>

<div class="viewcode-block" id="WorkflowManager.submit_build_analysis"><a class="viewcode-back" href="../../../thoth.common.html#thoth.common.workflows.WorkflowManager.submit_build_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">submit_build_analysis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">template_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">workflow_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Submit build analysis workflow.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Infra namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="s2">&quot;Middletier namespace was not provided.&quot;</span><span class="p">)</span>

        <span class="n">template_parameters</span> <span class="o">=</span> <span class="n">template_parameters</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">workflow_parameters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">workflow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_workflow_from_template</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">infra_namespace</span><span class="p">,</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="s2">&quot;template=build-analysis&quot;</span><span class="p">,</span>
            <span class="n">template_parameters</span><span class="o">=</span><span class="n">template_parameters</span><span class="p">,</span>
            <span class="n">workflow_parameters</span><span class="o">=</span><span class="n">workflow_parameters</span><span class="p">,</span>
            <span class="n">workflow_namespace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">middletier_namespace</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">workflow_id</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation index</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

  
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>

  </body>
</html>